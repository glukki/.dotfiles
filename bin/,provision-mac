#!/bin/sh

# Mac setup script

# UI
defaults write .GlobalPreferences AppleAccentColor 1
defaults write .GlobalPreferences AppleHighlightColor "1.000000 0.874510 0.701961 Orange"
defaults write .GlobalPreferences AppleInterfaceStyle Dark
defaults write .GlobalPreferences AppleEnableSwipeNavigateWithScrolls 0
defaults write .GlobalPreferences AppleShowAllExtensions 1
defaults write .GlobalPreferences AppleShowScrollBars Always
defaults write .GlobalPreferences AppleWindowTabbingMode always
defaults write .GlobalPreferences _HIHideMenuBar 1
defaults write .GlobalPreferences NSQuitAlwaysKeepsWindows 1

# Sound
defaults write .GlobalPreferences com.apple.sound.beep.feedback 0
defaults write .GlobalPreferences com.apple.sound.beep.flash 0

# Keyboard
defaults write .GlobalPreferences NSAutomaticDashSubstitutionEnabled 1
defaults write .GlobalPreferences NSAutomaticPeriodSubstitutionEnabled 0
defaults write .GlobalPreferences NSAutomaticQuoteSubstitutionEnabled 1
defaults write .GlobalPreferences NSAutomaticSpellingCorrectionEnabled 1
defaults write .GlobalPreferences NSAutomaticTextCompletionCollapsed 1
defaults write .GlobalPreferences NSAutomaticTextCompletionEnabled 1
defaults write .GlobalPreferences WebAutomaticSpellingCorrectionEnabled 1

# Mouse
defaults write .GlobalPreferences com.apple.mouse.scaling -1 # no mouse acceleration
defaults write .GlobalPreferences com.apple.springing.enabled 1
defaults write .GlobalPreferences com.apple.trackpad.forceClick 1

# Finder
defaults write com.apple.finder FXEnableExtensionChangeWarning 0
defaults write com.apple.finder FXRemoveOldTrashItems 1
defaults write com.apple.finder ShowRecentTags 0
defaults write com.apple.finder NewWindowTarget "PfHm"
defaults write com.apple.finder NewWindowTargetPath "file://$HOME/"

# Nix
sh <(curl --proto '=https' --tlsv1.2 -L https://nixos.org/nix/install)

# Homebrew
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Shell
brew install fish
FISH_PATH = "$(brew --repo)/bin/fish"
echo $FISH_PATH | sudo tee -a /etc/shells
chsh -s $FISH_PATH
curl https://raw.githubusercontent.com/oh-my-fish/oh-my-fish/master/bin/install | fish
omf install

# Containers
# Note: `molten-vk-krunkit` formula conflicts with `molten-vk` formula
brew tap slp/krunkit
brew install \
  krunkit \
  podman \
  podman-desktop \
  podman-compose \
  podman-tui
podman machine init

# Taps
brew tap mongodb/brew

# Shell apps
brew install \
  curl \
  direnv \
  dnsmasq \
  cloudflare/cloudflare/cloudflared \
  parallel \
  teleport \
  difftastic \
  duti \
  exercism \
  ffmpeg \
  gh \
  git \
  gnu-time \
  go \
  graphviz \
  hostess \
  htop \
  httrack \
  hub \
  jq \
  mas \
  micro \
  neovim \
  node \
  nvm \
  rclone \
  rtmpdump \
  rust \
  shellcheck \
  speedtest-cli \
  stow \
  tldr \
  uv \
  watchman \
  wget \
  youtube-dl

# Crates binary fetcher
cargo install cargo-binstall

# Crates
cargo binstall -y fd-find
cargo binstall -y flamegraph
cargo binstall -y ripgrep
cargo binstall -y solo2
cargo binstall -y xh
cargo binstall -y zellij

# Radicle
curl -sSf https://radicle.xyz/install | sh

# UV tools
uv tool install --python 3.12 openhands-ai

# Font
brew install \
  font-hack \
  font-hack-nerd-font

# GUI apps
brew install alacritty

brew install \
  balenaetcher \
  dash \
  discord \
  figma \
  google-chrome \
  hammerspoon \
  imageoptim \
  insomnia \
  jetbrains-toolbox \
  mpv \
  resilio-sync \
  slack \
  spotify \
  sublime-merge \
  sublime-text \
  telegram \
  transmission \
  virtualbox \
  virtualbox-extension-pack \
  visual-studio-code \
  zoom

# run again to skip krunkit conflict
brew install mpv


# associate file extensions with mpv player
duti -s io.mpv avi viewer
duti -s io.mpv mkv viewer
duti -s io.mpv mp4 viewer
duti -s io.mpv m4v viewer
duti -s io.mpv webm viewer
duti -s com.sublimetext.4 txt editor
duti -s com.sublimetext.4 csv editor


# Mac App Store
mas install 723185815 & # iZip Viewer
mas install 409183694 & # Keynote
mas install 405399194 & # Kindle
mas install 533696630 & # Webcam Settings
mas install 1107421413 & # 1Blocker
mas install 858446756 & # World Clock Pro
mas install 1496833156 & # Playgrounds
mas install 407963104 & # Pixelmator
mas install 1153157709 & # Speedtest
mas install 409203825 & # Numbers
mas install 497799835 & # Xcode
mas install 1147396723 & # WhatsApp
mas install 409201541 & # Pages
mas install 1137020764 & # NotePlan 2
mas install 408981434 & # iMovie
mas install 1176895641 & # Spark
mas install 1081413713 & # GIF Brewery by Gfycat
mas install 566555032 & # SuperGenPass
mas install 470158793 & # Keka
